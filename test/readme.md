This improved version includes:

* Error Handling: Improved error handling to be more robust.
* Code Organization: Split the code into multiple files for better readability and maintainability.
* Memory Management: Ensured there are no memory leaks.
* Logging: Added logging for better debugging.
* Threading: Used threads instead of fork to handle input/output concurrently.
